
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../..">
      
      
        <link rel="next" href="../model_hub/">
      
      
      <link rel="icon" href="../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>Tutorial - Aana SDK</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-create-a-new-project-with-aana-sdk" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Aana SDK" class="md-header__button md-logo" aria-label="Aana SDK" data-md-component="logo">
      
  <img src="../../images/white_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Aana SDK
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tutorial
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mobiusml/aana_sdk" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    mobiusml/aana_sdk
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../model_hub/" class="md-tabs__link">
          
  
    
  
  Model Hub

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../integrations/" class="md-tabs__link">
          
  
    
  
  Integrations

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../docker/" class="md-tabs__link">
          
  
    
  
  Deployment

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../settings/" class="md-tabs__link">
          
  
    
  
  Configuration

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../code_overview/" class="md-tabs__link">
          
  
    
  
  Development

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/" class="md-tabs__link">
          
  
    
  
  Reference (Code API)

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Aana SDK" class="md-nav__button md-logo" aria-label="Aana SDK" data-md-component="logo">
      
  <img src="../../images/white_logo.png" alt="logo">

    </a>
    Aana SDK
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mobiusml/aana_sdk" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    mobiusml/aana_sdk
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#video-transcription-application" class="md-nav__link">
    <span class="md-ellipsis">
      Video Transcription Application
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Running the Application
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-components" class="md-nav__link">
    <span class="md-ellipsis">
      Application Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Application Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deployments" class="md-nav__link">
    <span class="md-ellipsis">
      Deployments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      Endpoints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application" class="md-nav__link">
    <span class="md-ellipsis">
      Application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connecting-to-the-deployments" class="md-nav__link">
    <span class="md-ellipsis">
      Connecting to the Deployments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transcript-summarization-application" class="md-nav__link">
    <span class="md-ellipsis">
      Transcript Summarization Application
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transcript Summarization Application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#llm-model" class="md-nav__link">
    <span class="md-ellipsis">
      LLM Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summarization-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Summarization Endpoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extending-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Extending the Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#streaming-llm-output" class="md-nav__link">
    <span class="md-ellipsis">
      Streaming LLM Output
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app-template" class="md-nav__link">
    <span class="md-ellipsis">
      App Template
    </span>
  </a>
  
    <nav class="md-nav" aria-label="App Template">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-new-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Create a New Repository
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clone-the-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Clone the Repository
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Create the Application
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create the Application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deployments_1" class="md-nav__link">
    <span class="md-ellipsis">
      Deployments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#endpoints_1" class="md-nav__link">
    <span class="md-ellipsis">
      Endpoints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Run the Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../model_hub/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Model Hub
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Model Hub
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../model_hub/text_generation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Text Generation Models (LLMs)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../model_hub/image_to_text/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Image-to-Text Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../model_hub/asr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automatic Speech Recognition (ASR) Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../model_hub/speaker_recognition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Speaker Recognition
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../model_hub/hf_pipeline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hugging Face Pipeline Models
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Integrations
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Integrations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integrations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployments
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openai_api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenAI API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Deployment
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../serve_config_files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Serve Config Files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cluster_setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cluster Setup
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Settings
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Development
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../code_overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dev_environment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dev Environment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../code_standards/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code Standards
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../database/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Database
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Reference (Code API)
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Reference (Code API)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/sdk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SDK
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/endpoint/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Endpoint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/deployments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployments
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/models/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Models
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8_6" id="__nav_8_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_6">
            <span class="md-nav__icon md-icon"></span>
            Models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/models/media/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Media Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/models/asr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ASR Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/models/captions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Caption Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/models/chat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chat Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/models/image_chat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Image Chat Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/models/custom_config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/models/sampling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sampling Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/models/time/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Time Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/models/types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Types Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/models/vad/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VAD Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/models/speaker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Speaker Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/models/video/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Video Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/models/whisper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Whisper Models
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/storage/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Storage
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8_7" id="__nav_8_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_7">
            <span class="md-nav__icon md-icon"></span>
            Storage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/storage/models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/storage/repositories/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Repositories
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/integrations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/processors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Processors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/exceptions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exceptions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utility functions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#video-transcription-application" class="md-nav__link">
    <span class="md-ellipsis">
      Video Transcription Application
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Running the Application
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-components" class="md-nav__link">
    <span class="md-ellipsis">
      Application Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Application Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deployments" class="md-nav__link">
    <span class="md-ellipsis">
      Deployments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      Endpoints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application" class="md-nav__link">
    <span class="md-ellipsis">
      Application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connecting-to-the-deployments" class="md-nav__link">
    <span class="md-ellipsis">
      Connecting to the Deployments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transcript-summarization-application" class="md-nav__link">
    <span class="md-ellipsis">
      Transcript Summarization Application
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transcript Summarization Application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#llm-model" class="md-nav__link">
    <span class="md-ellipsis">
      LLM Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summarization-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Summarization Endpoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extending-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Extending the Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#streaming-llm-output" class="md-nav__link">
    <span class="md-ellipsis">
      Streaming LLM Output
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app-template" class="md-nav__link">
    <span class="md-ellipsis">
      App Template
    </span>
  </a>
  
    <nav class="md-nav" aria-label="App Template">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-new-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Create a New Repository
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clone-the-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Clone the Repository
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Create the Application
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create the Application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deployments_1" class="md-nav__link">
    <span class="md-ellipsis">
      Deployments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#endpoints_1" class="md-nav__link">
    <span class="md-ellipsis">
      Endpoints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Run the Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<style>
.md-content .md-typeset h1 { 
  position: absolute;
  left: -999px;
}
</style>

<h1 id="how-to-create-a-new-project-with-aana-sdk">How to Create a New Project with Aana SDK<a class="headerlink" href="#how-to-create-a-new-project-with-aana-sdk" title="Permanent link">&para;</a></h1>
<p>Aana SDK is a powerful framework for building multimodal applications. It facilitates the large-scale deployment of machine learning models, including those for vision, audio, and language, and supports Retrieval-Augmented Generation (RAG) systems. This enables the development of advanced applications such as search engines, recommendation systems, and data insights platforms.</p>
<p>Aana SDK comes with a set of example applications that demonstrate the capabilities of the SDK. These applications can be used as a reference to build your own applications. See the <a href="https://github.com/mobiusml/aana_sdk/tree/main/aana/projects/">projects</a> directory for the example applications.</p>
<p>If you want to start building a new application, you can use the following GitHub template: <a href="https://github.com/mobiusml/aana_app_template">Aana App Template</a>. It will help you get started with the Aana SDK and provide you with a basic structure for your application and its dependencies.</p>
<p>In this tutorial, we will walk you through the process of creating a new project with Aana SDK. By the end of this tutorial, you will have a runnable application that transcribes a video and summarizes the transcript using a Language Model (LLM). We will use <a href="../../#creating-a-new-application">the video transcription application</a> as a starting point and extend it to include the LLM model for summarization and a new endpoints.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>Before you begin, make sure you have a working installation of Aana SDK. See the <a href="../../#installation">installation instructions</a> for more information.</p>
<h2 id="video-transcription-application">Video Transcription Application<a class="headerlink" href="#video-transcription-application" title="Permanent link">&para;</a></h2>
<p>First, let's review a video transcription application. Here is the code for it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.api.api_generation</span><span class="w"> </span><span class="kn">import</span> <span class="n">Endpoint</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.core.models.video</span><span class="w"> </span><span class="kn">import</span> <span class="n">VideoInput</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.deployments.aana_deployment_handle</span><span class="w"> </span><span class="kn">import</span> <span class="n">AanaDeploymentHandle</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.deployments.whisper_deployment</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">WhisperComputeType</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">WhisperConfig</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">WhisperDeployment</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">WhisperModelSize</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">WhisperOutput</span><span class="p">,</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="p">)</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.integrations.external.yt_dlp</span><span class="w"> </span><span class="kn">import</span> <span class="n">download_video</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.processors.remote</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_remote</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.processors.video</span><span class="w"> </span><span class="kn">import</span> <span class="n">extract_audio</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.sdk</span><span class="w"> </span><span class="kn">import</span> <span class="n">AanaSDK</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="c1"># Define the model deployments.</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="n">asr_deployment</span> <span class="o">=</span> <span class="n">WhisperDeployment</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    <span class="n">num_replicas</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="n">ray_actor_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_gpus&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">},</span> <span class="c1"># Remove this line if you want to run Whisper on a CPU.</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>    <span class="n">user_config</span><span class="o">=</span><span class="n">WhisperConfig</span><span class="p">(</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>        <span class="n">model_size</span><span class="o">=</span><span class="n">WhisperModelSize</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>        <span class="n">compute_type</span><span class="o">=</span><span class="n">WhisperComputeType</span><span class="o">.</span><span class="n">FLOAT16</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>    <span class="p">)</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">),</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="p">)</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="n">deployments</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;asr_deployment&quot;</span><span class="p">,</span> <span class="s2">&quot;instance&quot;</span><span class="p">:</span> <span class="n">asr_deployment</span><span class="p">}]</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="c1"># Define the endpoint to transcribe the video.</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="k">class</span><span class="w"> </span><span class="nc">TranscribeVideoEndpoint</span><span class="p">(</span><span class="n">Endpoint</span><span class="p">):</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Transcribe video endpoint.&quot;&quot;&quot;</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the endpoint.&quot;&quot;&quot;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>        <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">asr_handle</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AanaDeploymentHandle</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;asr_deployment&quot;</span><span class="p">)</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video</span><span class="p">:</span> <span class="n">VideoInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WhisperOutput</span><span class="p">:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Transcribe video.&quot;&quot;&quot;</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>        <span class="n">video_obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_remote</span><span class="p">(</span><span class="n">download_video</span><span class="p">)(</span><span class="n">video_input</span><span class="o">=</span><span class="n">video</span><span class="p">)</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>        <span class="n">audio</span> <span class="o">=</span> <span class="n">extract_audio</span><span class="p">(</span><span class="n">video</span><span class="o">=</span><span class="n">video_obj</span><span class="p">)</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>        <span class="n">transcription</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">asr_handle</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span><span class="n">audio</span><span class="o">=</span><span class="n">audio</span><span class="p">)</span>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>        <span class="k">return</span> <span class="n">transcription</span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a><span class="n">endpoints</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>    <span class="p">{</span>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;transcribe_video&quot;</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/video/transcribe&quot;</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>        <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="s2">&quot;Transcribe a video&quot;</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>        <span class="s2">&quot;endpoint_cls&quot;</span><span class="p">:</span> <span class="n">TranscribeVideoEndpoint</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>    <span class="p">},</span>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a><span class="p">]</span>
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a><span class="n">aana_app</span> <span class="o">=</span> <span class="n">AanaSDK</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;transcribe_video_app&quot;</span><span class="p">)</span>
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a><span class="k">for</span> <span class="n">deployment</span> <span class="ow">in</span> <span class="n">deployments</span><span class="p">:</span>
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a>    <span class="n">aana_app</span><span class="o">.</span><span class="n">register_deployment</span><span class="p">(</span><span class="o">**</span><span class="n">deployment</span><span class="p">)</span>
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a><span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="n">endpoints</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a>    <span class="n">aana_app</span><span class="o">.</span><span class="n">register_endpoint</span><span class="p">(</span><span class="o">**</span><span class="n">endpoint</span><span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a>    <span class="n">aana_app</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">show_logs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Connects to the Ray cluster or starts a new one.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a>    <span class="n">aana_app</span><span class="o">.</span><span class="n">migrate</span><span class="p">()</span>                                              <span class="c1"># Runs the migrations to create the database tables.</span>
<a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a>    <span class="n">aana_app</span><span class="o">.</span><span class="n">deploy</span><span class="p">(</span><span class="n">blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                  <span class="c1"># Deploys the application.</span>
</code></pre></div>
<h2 id="running-the-application">Running the Application<a class="headerlink" href="#running-the-application" title="Permanent link">&para;</a></h2>
<p>You have a few options to run the application:</p>
<ul>
<li>Copy the code above and run it in a Jupyter notebook.</li>
<li>Save the code to a Python file, for example <code>app.py</code>, and run it as a Python script: <code>python app.py</code>.</li>
<li>Save the code to a Python file, for example <code>app.py</code>, and run it using the Aana CLI: <code>aana deploy app:aana_app --host 127.0.0.1 --port 8000 --hide-logs</code>.</li>
</ul>
<p>Once the application is running, you will see the message <code>Deployed successfully.</code> in the logs. You can now send a request to the application to transcribe a video.</p>
<p>To get an overview of the Ray cluster, you can use the Ray Dashboard. The Ray Dashboard is available at <code>http://127.0.0.1:8265</code> by default. You can see the status of the Ray cluster, the resources used, running applications and deployments, logs, and more. It is a useful tool for monitoring and debugging your applications. See <a href="https://docs.ray.io/en/latest/ray-observability/getting-started.html">Ray Dashboard documentation</a> for more information.</p>
<p>Let's transcribe <a href="https://www.youtube.com/watch?v=VhJFyyukAzA">Gordon Ramsay's perfect scrambled eggs tutorial</a> using the application.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://127.0.0.1:8000/video/transcribe<span class="w"> </span>-Fbody<span class="o">=</span><span class="s1">&#39;{&quot;video&quot;:{&quot;url&quot;:&quot;https://www.youtube.com/watch?v=VhJFyyukAzA&quot;}}&#39;</span>
</code></pre></div>
<h2 id="application-components">Application Components<a class="headerlink" href="#application-components" title="Permanent link">&para;</a></h2>
<p>The application consists of 3 main components: the deployment, the endpoint, and the application itself. </p>
<h3 id="deployments">Deployments<a class="headerlink" href="#deployments" title="Permanent link">&para;</a></h3>
<p>Deployments are the building blocks of Aana SDK. They represent the machine learning models that you want to deploy. Aana SDK comes with a set of predefined deployments that you can use or you can define your own deployments. See <a href="../integrations/">Integrations</a> for more information about predefined deployments.</p>
<p>Each deployment has a main class that defines it and a configuration class that allows you to specify the deployment parameters.</p>
<p>In the example above, we define a deployment for the Whisper model that allows you to transcribe audio. The deployment is defined as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.deployments.whisper_deployment</span><span class="w"> </span><span class="kn">import</span> <span class="n">WhisperDeployment</span><span class="p">,</span> <span class="n">WhisperConfig</span><span class="p">,</span> <span class="n">WhisperModelSize</span><span class="p">,</span> <span class="n">WhisperComputeType</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">asr_deployment</span> <span class="o">=</span> <span class="n">WhisperDeployment</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="n">num_replicas</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="n">ray_actor_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_gpus&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">},</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="n">user_config</span><span class="o">=</span><span class="n">WhisperConfig</span><span class="p">(</span><span class="n">model_size</span><span class="o">=</span><span class="n">WhisperModelSize</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="n">compute_type</span><span class="o">=</span><span class="n">WhisperComputeType</span><span class="o">.</span><span class="n">FLOAT16</span><span class="p">)</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">),</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="p">)</span>
</code></pre></div>
<h3 id="endpoints">Endpoints<a class="headerlink" href="#endpoints" title="Permanent link">&para;</a></h3>
<p>Endpoints define the functionality of your application. They allow you to connect multiple deployments (models) to each other and define the input and output of your application.</p>
<p>Each endpoint is defined as a class that inherits from the <code>Endpoint</code> class. The class has two main methods: <code>initialize</code> and <code>run</code>.</p>
<p><code>initialize</code> method contains actions that need to be performed before the endpoint is run. For example, you can create handles for the deployments that the endpoint will use.</p>
<p><code>run</code> method is the main method of the endpoint that is called when the endpoint receives a request. </p>
<p>The <code>run</code> method should be annotated with the input and output types. The types should be pydantic models. Return type should be a typed dictionary where the keys are strings and the values are pydantic models.</p>
<p>For example, you can define an endpoint that transcribes a video like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">TranscribeVideoEndpoint</span><span class="p">(</span><span class="n">Endpoint</span><span class="p">):</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Transcribe video endpoint.&quot;&quot;&quot;</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the endpoint.&quot;&quot;&quot;</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>        <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">asr_handle</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AanaDeploymentHandle</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;asr_deployment&quot;</span><span class="p">)</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video</span><span class="p">:</span> <span class="n">VideoInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WhisperOutput</span><span class="p">:</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Transcribe video.&quot;&quot;&quot;</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>        <span class="n">video_obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_remote</span><span class="p">(</span><span class="n">download_video</span><span class="p">)(</span><span class="n">video_input</span><span class="o">=</span><span class="n">video</span><span class="p">)</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>        <span class="n">audio</span> <span class="o">=</span> <span class="n">extract_audio</span><span class="p">(</span><span class="n">video</span><span class="o">=</span><span class="n">video_obj</span><span class="p">)</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>        <span class="n">transcription</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">asr_handle</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span><span class="n">audio</span><span class="o">=</span><span class="n">audio</span><span class="p">)</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>        <span class="k">return</span> <span class="n">transcription</span>
</code></pre></div>
<h3 id="application">Application<a class="headerlink" href="#application" title="Permanent link">&para;</a></h3>
<p>AanaSDK is the main class that represents the application. It allows you to deploy the deployments and endpoints you defined and start the application.</p>
<p>For example, you can define an application that transcribes a video like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">aana_app</span> <span class="o">=</span> <span class="n">AanaSDK</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;transcribe_video_app&quot;</span><span class="p">)</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="c1"># Register the ASR deployment.</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="n">aana_app</span><span class="o">.</span><span class="n">register_deployment</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;asr_deployment&quot;</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">asr_deployment</span><span class="p">)</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="c1"># Register the transcribe video endpoint.</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="n">aana_app</span><span class="o">.</span><span class="n">register_endpoint</span><span class="p">(</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;transcribe_video&quot;</span><span class="p">,</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/video/transcribe&quot;</span><span class="p">,</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;Transcribe a video&quot;</span><span class="p">,</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>    <span class="n">endpoint_cls</span><span class="o">=</span><span class="n">TranscribeVideoEndpoint</span><span class="p">,</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="p">)</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="n">aana_app</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>  <span class="c1"># Connects to the Ray cluster or starts a new one.</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="n">aana_app</span><span class="o">.</span><span class="n">migrate</span><span class="p">()</span>  <span class="c1"># Runs the migrations to create the database tables.</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="n">aana_app</span><span class="o">.</span><span class="n">deploy</span><span class="p">()</span>   <span class="c1"># Deploys the application.</span>
</code></pre></div>
<h3 id="connecting-to-the-deployments">Connecting to the Deployments<a class="headerlink" href="#connecting-to-the-deployments" title="Permanent link">&para;</a></h3>
<p>Once the application is deployed, you can also access the deployments from other processes or applications using the <code>AanaSDK</code> class. For example, you can access the ASR deployment like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.sdk</span><span class="w"> </span><span class="kn">import</span> <span class="n">AanaSDK</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.deployments.aana_deployment_handle</span><span class="w"> </span><span class="kn">import</span> <span class="n">AanaDeploymentHandle</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="n">aana_app</span> <span class="o">=</span> <span class="n">AanaSDK</span><span class="p">()</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="n">asr_handle</span> <span class="o">=</span> <span class="n">AanaDeploymentHandle</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;asr_deployment&quot;</span><span class="p">)</span>
</code></pre></div>
<p>The name of the deployment used to create the handle should match the name of the deployment when <code>register_deployment</code> was called.</p>
<p>This is quite useful for testing or debugging your application.</p>
<h2 id="transcript-summarization-application">Transcript Summarization Application<a class="headerlink" href="#transcript-summarization-application" title="Permanent link">&para;</a></h2>
<p>Now that we have reviewed the video transcription application, let's build on it to create a video transcript summarization application. For the summarization we will need a few extra components:</p>
<ul>
<li>An LLM model to summarize the transcript.</li>
<li>An endpoint to summarize the transcript.</li>
</ul>
<h3 id="llm-model">LLM Model<a class="headerlink" href="#llm-model" title="Permanent link">&para;</a></h3>
<p>LLM model can be registered as a deployment in the application. Aana SDK provides two deployments that can be used to deploy LLM models:</p>
<ul>
<li><code>HfTextGenerationDeployment</code>: A deployment based on Hugging Face Transformers library.</li>
<li><code>VLLMDeployment</code>: A deployment based on vLLM library.</li>
</ul>
<p>Both deployments have the same interface and can be used interchangeably. In this example, we will use <code>HfTextGenerationDeployment</code>.</p>
<p>Here is an example of how to define an LLM deployment:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.deployments.hf_text_generation_deployment</span><span class="w"> </span><span class="kn">import</span> <span class="n">HfTextGenerationConfig</span><span class="p">,</span> <span class="n">HfTextGenerationDeployment</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">llm_deployment</span> <span class="o">=</span> <span class="n">HfTextGenerationDeployment</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    <span class="n">num_replicas</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    <span class="n">ray_actor_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_gpus&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">},</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    <span class="n">user_config</span><span class="o">=</span><span class="n">HfTextGenerationConfig</span><span class="p">(</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>        <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;microsoft/Phi-3-mini-4k-instruct&quot;</span><span class="p">,</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>        <span class="n">model_kwargs</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>            <span class="s2">&quot;trust_remote_code&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>            <span class="s2">&quot;quantization_config&quot;</span><span class="p">:</span> <span class="n">BitsAndBytesConfig</span><span class="p">(</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>                <span class="n">load_in_8bit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">load_in_4bit</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>            <span class="p">),</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>        <span class="p">},</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>    <span class="p">)</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">),</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="p">)</span>
</code></pre></div>
<p>Let's take a closer look at the configuration options:</p>
<ul>
<li><code>HfTextGenerationDeployment</code> is the deployment class.</li>
<li><code>num_replicas=1</code> specifies the number of replicas to deploy. If you want to scale the deployment, you can increase this number to deploy more replicas on more GPUs or nodes.</li>
<li><code>ray_actor_options={"num_gpus": 0.25}</code> specifies the number of GPUs that each replica requires. This will be used to allocate resources on the Ray cluster but keep in mind that it will not limit the deployment to use only this amount of GPUs, it's only used for resource allocation. If you want to run the deployment on a CPU, you can remove this line.</li>
<li><code>user_config</code> is the configuration object for the deployment. In this case, we are using <code>HfTextGenerationConfig</code> that is specific to <code>HfTextGenerationDeployment</code>. </li>
<li><code>model_id</code> is the Hugging Face model ID that you want to deploy. You can find the model ID on the Hugging Face model hub.</li>
<li><code>model_kwargs</code> is a dictionary of additional keyword arguments that you want to pass to the model. In this case, we are using <code>trust_remote_code</code> as it's required by the model and <code>quantization_config</code> to load the model in 4-bit precision. Check the model documentation for the required keyword arguments.</li>
</ul>
<h3 id="summarization-endpoint">Summarization Endpoint<a class="headerlink" href="#summarization-endpoint" title="Permanent link">&para;</a></h3>
<p>Now that we have the LLM, we can define an endpoint to summarize the transcript and use the LLM deployment in it.</p>
<p>Here is an example of how to define a summarization endpoint:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">SummarizeVideoEndpointOutput</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Summarize video endpoint output.&quot;&quot;&quot;</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="n">summary</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;The summary of the video.&quot;</span><span class="p">)]</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">SummarizeVideoEndpoint</span><span class="p">(</span><span class="n">Endpoint</span><span class="p">):</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Summarize video endpoint.&quot;&quot;&quot;</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the endpoint.&quot;&quot;&quot;</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>        <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">asr_handle</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AanaDeploymentHandle</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;asr_deployment&quot;</span><span class="p">)</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">llm_handle</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AanaDeploymentHandle</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;llm_deployment&quot;</span><span class="p">)</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video</span><span class="p">:</span> <span class="n">VideoInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SummarizeVideoEndpointOutput</span><span class="p">:</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Summarize video.&quot;&quot;&quot;</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>        <span class="n">video_obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_remote</span><span class="p">(</span><span class="n">download_video</span><span class="p">)(</span><span class="n">video_input</span><span class="o">=</span><span class="n">video</span><span class="p">)</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>        <span class="n">audio</span> <span class="o">=</span> <span class="n">extract_audio</span><span class="p">(</span><span class="n">video</span><span class="o">=</span><span class="n">video_obj</span><span class="p">)</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>        <span class="n">transcription</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">asr_handle</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span><span class="n">audio</span><span class="o">=</span><span class="n">audio</span><span class="p">)</span>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>        <span class="n">transcription_text</span> <span class="o">=</span> <span class="n">transcription</span><span class="p">[</span><span class="s2">&quot;transcription&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>        <span class="n">dialog</span> <span class="o">=</span> <span class="n">ChatDialog</span><span class="p">(</span>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>            <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>                <span class="n">ChatMessage</span><span class="p">(</span>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>                    <span class="n">role</span><span class="o">=</span><span class="s2">&quot;system&quot;</span><span class="p">,</span>
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>                    <span class="n">content</span><span class="o">=</span><span class="s2">&quot;You are a helpful assistant that can summarize audio transcripts.&quot;</span><span class="p">,</span>
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>                <span class="p">),</span>
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a>                <span class="n">ChatMessage</span><span class="p">(</span>
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>                    <span class="n">role</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>                    <span class="n">content</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Summarize the following video transcript into a list of bullet points: </span><span class="si">{</span><span class="n">transcription_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>                <span class="p">),</span>
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>            <span class="p">]</span>
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>        <span class="p">)</span>
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>        <span class="n">summary_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm_handle</span><span class="o">.</span><span class="n">chat</span><span class="p">(</span><span class="n">dialog</span><span class="o">=</span><span class="n">dialog</span><span class="p">)</span>
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a>        <span class="n">summary_message</span><span class="p">:</span> <span class="n">ChatMessage</span> <span class="o">=</span> <span class="n">summary_response</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span>
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a>        <span class="n">summary</span> <span class="o">=</span> <span class="n">summary_message</span><span class="o">.</span><span class="n">content</span>
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="p">}</span>
</code></pre></div>
<p>In this example, we define a new endpoint class <code>SummarizeVideoEndpoint</code> that inherits from the <code>Endpoint</code> class. The class has two main methods: <code>initialize</code> and <code>run</code>.</p>
<p>In the <code>initialize</code> method, we create handles for the ASR and LLM deployments.</p>
<p><code>run</code> method is the main method of the endpoint. The <code>run</code> method should be annotated with the input and output types. In this case, we only have one input <code>video</code> of type <code>VideoInput</code> and the output is a dictionary with one key <code>summary</code> of type <code>str</code>. The output type is defined as a <code>TypedDict</code> called <code>SummarizeVideoEndpointOutput</code>.</p>
<p>The <code>run</code> method performs the following steps:</p>
<ul>
<li>Downloading the video: We use the <code>download_video</code> function from the <code>yt_dlp</code> integration to download the video. The <code>run_remote</code> function is used to run the function as a remote task in the Ray cluster. It is useful to run heavy tasks with <code>run_remote</code> to offload the main thread.</li>
<li>Extracting the audio from the video: We use the <code>extract_audio</code> function from the <code>video</code> processor to extract the audio.</li>
<li>Transcribing the audio: We call ASR deployment to transcribe the audio. Here we use ASR deployment handle that we created in the <code>initialize</code> method. Calling the deployment is as simple as calling a method on the handle. The call is asynchronous so we use <code>await</code> to wait for the result.</li>
<li>Creating a chat dialog: We create a chat dialog with a system message and a user message. The user message contains the transcription text that we want to summarize.</li>
<li>Summarizing the transcript: We call the LLM deployment to summarize the transcript. Here we use the LLM deployment handle that we created in the <code>initialize</code> method. The call is similar to the ASR deployment call. We pass the chat dialog to the LLM deployment and wait for the response with <code>await</code>.</li>
<li>Returning the summary: We return the summary as a dictionary with one key <code>summary</code>. Just like the type annotation tells us.</li>
<li>The summary has type <code>Annotated[str, Field(description="The summary of the video.")]</code> which means it's a string with a description. The description is used to generate the API documentation. You can use <code>Annotated</code> and <code>Field</code> to add more metadata to your types (input and output) to generate better API documentation.</li>
</ul>
<h3 id="extending-the-application">Extending the Application<a class="headerlink" href="#extending-the-application" title="Permanent link">&para;</a></h3>
<p>Now that we have the LLM deployment and the summarization endpoint, we can extend the application to include the LLM deployment and the summarization endpoint.</p>
<p>Here is an example of how to extend the application:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">aana_app</span> <span class="o">=</span> <span class="n">AanaSDK</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;summarize_video_app&quot;</span><span class="p">)</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="c1"># Register the ASR deployment.</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="n">aana_app</span><span class="o">.</span><span class="n">register_deployment</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;asr_deployment&quot;</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">asr_deployment</span><span class="p">)</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="c1"># Register the LLM deployment.</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="n">aana_app</span><span class="o">.</span><span class="n">register_deployment</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;llm_deployment&quot;</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">llm_deployment</span><span class="p">)</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="c1"># Register the transcribe video endpoint.</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="n">aana_app</span><span class="o">.</span><span class="n">register_endpoint</span><span class="p">(</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;transcribe_video&quot;</span><span class="p">,</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/video/transcribe&quot;</span><span class="p">,</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>    <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;Transcribe a video&quot;</span><span class="p">,</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>    <span class="n">endpoint_cls</span><span class="o">=</span><span class="n">TranscribeVideoEndpoint</span><span class="p">,</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="p">)</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="c1"># Register the summarize video endpoint.</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="n">aana_app</span><span class="o">.</span><span class="n">register_endpoint</span><span class="p">(</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;summarize_video&quot;</span><span class="p">,</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/video/summarize&quot;</span><span class="p">,</span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>    <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;Summarize a video transcript&quot;</span><span class="p">,</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>    <span class="n">endpoint_cls</span><span class="o">=</span><span class="n">SummarizeVideoEndpoint</span><span class="p">,</span>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="p">)</span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="n">aana_app</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>  <span class="c1"># Connects to the Ray cluster or starts a new one.</span>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="n">aana_app</span><span class="o">.</span><span class="n">migrate</span><span class="p">()</span>  <span class="c1"># Runs the migrations to create the database tables.</span>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="n">aana_app</span><span class="o">.</span><span class="n">deploy</span><span class="p">()</span>   <span class="c1"># Deploys the application.</span>
</code></pre></div>
<p>In this example, we define a new application called <code>summarize_video_app</code>. We register the ASR and LLM deployments and the transcribe and summarize video endpoints.</p>
<p>Here is the full code for the application:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncGenerator</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span><span class="p">,</span> <span class="n">TypedDict</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Field</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">BitsAndBytesConfig</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.api.api_generation</span><span class="w"> </span><span class="kn">import</span> <span class="n">Endpoint</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.core.models.chat</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChatDialog</span><span class="p">,</span> <span class="n">ChatMessage</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.core.models.video</span><span class="w"> </span><span class="kn">import</span> <span class="n">VideoInput</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.deployments.aana_deployment_handle</span><span class="w"> </span><span class="kn">import</span> <span class="n">AanaDeploymentHandle</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.deployments.hf_text_generation_deployment</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>    <span class="n">HfTextGenerationConfig</span><span class="p">,</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>    <span class="n">HfTextGenerationDeployment</span><span class="p">,</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="p">)</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.deployments.whisper_deployment</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>    <span class="n">WhisperComputeType</span><span class="p">,</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>    <span class="n">WhisperConfig</span><span class="p">,</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>    <span class="n">WhisperDeployment</span><span class="p">,</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>    <span class="n">WhisperModelSize</span><span class="p">,</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>    <span class="n">WhisperOutput</span><span class="p">,</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="p">)</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.integrations.external.yt_dlp</span><span class="w"> </span><span class="kn">import</span> <span class="n">download_video</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.processors.remote</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_remote</span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.processors.video</span><span class="w"> </span><span class="kn">import</span> <span class="n">extract_audio</span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.sdk</span><span class="w"> </span><span class="kn">import</span> <span class="n">AanaSDK</span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="c1"># Define the model deployments.</span>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="n">asr_deployment</span> <span class="o">=</span> <span class="n">WhisperDeployment</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>    <span class="n">num_replicas</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>    <span class="n">ray_actor_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_gpus&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">},</span>
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>    <span class="n">user_config</span><span class="o">=</span><span class="n">WhisperConfig</span><span class="p">(</span>
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>        <span class="n">model_size</span><span class="o">=</span><span class="n">WhisperModelSize</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>        <span class="n">compute_type</span><span class="o">=</span><span class="n">WhisperComputeType</span><span class="o">.</span><span class="n">FLOAT16</span><span class="p">,</span>
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>    <span class="p">)</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">),</span>
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="p">)</span>
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a>
<a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a><span class="n">llm_deployment</span> <span class="o">=</span> <span class="n">HfTextGenerationDeployment</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
<a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a>    <span class="n">num_replicas</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a>    <span class="n">ray_actor_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_gpus&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">},</span>
<a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a>    <span class="n">user_config</span><span class="o">=</span><span class="n">HfTextGenerationConfig</span><span class="p">(</span>
<a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a>        <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;microsoft/Phi-3-mini-4k-instruct&quot;</span><span class="p">,</span>
<a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a>        <span class="n">model_kwargs</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a>            <span class="s2">&quot;trust_remote_code&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a>            <span class="s2">&quot;quantization_config&quot;</span><span class="p">:</span> <span class="n">BitsAndBytesConfig</span><span class="p">(</span>
<a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a>                <span class="n">load_in_8bit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">load_in_4bit</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a>            <span class="p">),</span>
<a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a>        <span class="p">},</span>
<a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a>    <span class="p">)</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">),</span>
<a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a><span class="p">)</span>
<a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a>
<a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a>
<a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a><span class="n">deployments</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-9-53" name="__codelineno-9-53" href="#__codelineno-9-53"></a>    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;asr_deployment&quot;</span><span class="p">,</span> <span class="s2">&quot;instance&quot;</span><span class="p">:</span> <span class="n">asr_deployment</span><span class="p">},</span>
<a id="__codelineno-9-54" name="__codelineno-9-54" href="#__codelineno-9-54"></a>    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;llm_deployment&quot;</span><span class="p">,</span> <span class="s2">&quot;instance&quot;</span><span class="p">:</span> <span class="n">llm_deployment</span><span class="p">},</span>
<a id="__codelineno-9-55" name="__codelineno-9-55" href="#__codelineno-9-55"></a><span class="p">]</span>
<a id="__codelineno-9-56" name="__codelineno-9-56" href="#__codelineno-9-56"></a>
<a id="__codelineno-9-57" name="__codelineno-9-57" href="#__codelineno-9-57"></a>
<a id="__codelineno-9-58" name="__codelineno-9-58" href="#__codelineno-9-58"></a><span class="k">class</span><span class="w"> </span><span class="nc">SummarizeVideoEndpointOutput</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
<a id="__codelineno-9-59" name="__codelineno-9-59" href="#__codelineno-9-59"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Summarize video endpoint output.&quot;&quot;&quot;</span>
<a id="__codelineno-9-60" name="__codelineno-9-60" href="#__codelineno-9-60"></a>
<a id="__codelineno-9-61" name="__codelineno-9-61" href="#__codelineno-9-61"></a>    <span class="n">summary</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;The summary of the video.&quot;</span><span class="p">)]</span>
<a id="__codelineno-9-62" name="__codelineno-9-62" href="#__codelineno-9-62"></a>
<a id="__codelineno-9-63" name="__codelineno-9-63" href="#__codelineno-9-63"></a>
<a id="__codelineno-9-64" name="__codelineno-9-64" href="#__codelineno-9-64"></a><span class="c1"># Define the endpoint to transcribe the video.</span>
<a id="__codelineno-9-65" name="__codelineno-9-65" href="#__codelineno-9-65"></a><span class="k">class</span><span class="w"> </span><span class="nc">TranscribeVideoEndpoint</span><span class="p">(</span><span class="n">Endpoint</span><span class="p">):</span>
<a id="__codelineno-9-66" name="__codelineno-9-66" href="#__codelineno-9-66"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Transcribe video endpoint.&quot;&quot;&quot;</span>
<a id="__codelineno-9-67" name="__codelineno-9-67" href="#__codelineno-9-67"></a>
<a id="__codelineno-9-68" name="__codelineno-9-68" href="#__codelineno-9-68"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-9-69" name="__codelineno-9-69" href="#__codelineno-9-69"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the endpoint.&quot;&quot;&quot;</span>
<a id="__codelineno-9-70" name="__codelineno-9-70" href="#__codelineno-9-70"></a>        <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<a id="__codelineno-9-71" name="__codelineno-9-71" href="#__codelineno-9-71"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">asr_handle</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AanaDeploymentHandle</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;asr_deployment&quot;</span><span class="p">)</span>
<a id="__codelineno-9-72" name="__codelineno-9-72" href="#__codelineno-9-72"></a>
<a id="__codelineno-9-73" name="__codelineno-9-73" href="#__codelineno-9-73"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video</span><span class="p">:</span> <span class="n">VideoInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WhisperOutput</span><span class="p">:</span>
<a id="__codelineno-9-74" name="__codelineno-9-74" href="#__codelineno-9-74"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Transcribe video.&quot;&quot;&quot;</span>
<a id="__codelineno-9-75" name="__codelineno-9-75" href="#__codelineno-9-75"></a>        <span class="n">video_obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_remote</span><span class="p">(</span><span class="n">download_video</span><span class="p">)(</span><span class="n">video_input</span><span class="o">=</span><span class="n">video</span><span class="p">)</span>
<a id="__codelineno-9-76" name="__codelineno-9-76" href="#__codelineno-9-76"></a>        <span class="n">audio</span> <span class="o">=</span> <span class="n">extract_audio</span><span class="p">(</span><span class="n">video</span><span class="o">=</span><span class="n">video_obj</span><span class="p">)</span>
<a id="__codelineno-9-77" name="__codelineno-9-77" href="#__codelineno-9-77"></a>        <span class="n">transcription</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">asr_handle</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span><span class="n">audio</span><span class="o">=</span><span class="n">audio</span><span class="p">)</span>
<a id="__codelineno-9-78" name="__codelineno-9-78" href="#__codelineno-9-78"></a>        <span class="k">return</span> <span class="n">transcription</span>
<a id="__codelineno-9-79" name="__codelineno-9-79" href="#__codelineno-9-79"></a>
<a id="__codelineno-9-80" name="__codelineno-9-80" href="#__codelineno-9-80"></a>
<a id="__codelineno-9-81" name="__codelineno-9-81" href="#__codelineno-9-81"></a><span class="k">class</span><span class="w"> </span><span class="nc">SummarizeVideoEndpoint</span><span class="p">(</span><span class="n">Endpoint</span><span class="p">):</span>
<a id="__codelineno-9-82" name="__codelineno-9-82" href="#__codelineno-9-82"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Summarize video endpoint.&quot;&quot;&quot;</span>
<a id="__codelineno-9-83" name="__codelineno-9-83" href="#__codelineno-9-83"></a>
<a id="__codelineno-9-84" name="__codelineno-9-84" href="#__codelineno-9-84"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-9-85" name="__codelineno-9-85" href="#__codelineno-9-85"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the endpoint.&quot;&quot;&quot;</span>
<a id="__codelineno-9-86" name="__codelineno-9-86" href="#__codelineno-9-86"></a>        <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<a id="__codelineno-9-87" name="__codelineno-9-87" href="#__codelineno-9-87"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">asr_handle</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AanaDeploymentHandle</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;asr_deployment&quot;</span><span class="p">)</span>
<a id="__codelineno-9-88" name="__codelineno-9-88" href="#__codelineno-9-88"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">llm_handle</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AanaDeploymentHandle</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;llm_deployment&quot;</span><span class="p">)</span>
<a id="__codelineno-9-89" name="__codelineno-9-89" href="#__codelineno-9-89"></a>
<a id="__codelineno-9-90" name="__codelineno-9-90" href="#__codelineno-9-90"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video</span><span class="p">:</span> <span class="n">VideoInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SummarizeVideoEndpointOutput</span><span class="p">:</span>
<a id="__codelineno-9-91" name="__codelineno-9-91" href="#__codelineno-9-91"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Summarize video.&quot;&quot;&quot;</span>
<a id="__codelineno-9-92" name="__codelineno-9-92" href="#__codelineno-9-92"></a>        <span class="n">video_obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_remote</span><span class="p">(</span><span class="n">download_video</span><span class="p">)(</span><span class="n">video_input</span><span class="o">=</span><span class="n">video</span><span class="p">)</span>
<a id="__codelineno-9-93" name="__codelineno-9-93" href="#__codelineno-9-93"></a>        <span class="n">audio</span> <span class="o">=</span> <span class="n">extract_audio</span><span class="p">(</span><span class="n">video</span><span class="o">=</span><span class="n">video_obj</span><span class="p">)</span>
<a id="__codelineno-9-94" name="__codelineno-9-94" href="#__codelineno-9-94"></a>        <span class="n">transcription</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">asr_handle</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span><span class="n">audio</span><span class="o">=</span><span class="n">audio</span><span class="p">)</span>
<a id="__codelineno-9-95" name="__codelineno-9-95" href="#__codelineno-9-95"></a>        <span class="n">transcription_text</span> <span class="o">=</span> <span class="n">transcription</span><span class="p">[</span><span class="s2">&quot;transcription&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
<a id="__codelineno-9-96" name="__codelineno-9-96" href="#__codelineno-9-96"></a>        <span class="n">dialog</span> <span class="o">=</span> <span class="n">ChatDialog</span><span class="p">(</span>
<a id="__codelineno-9-97" name="__codelineno-9-97" href="#__codelineno-9-97"></a>            <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-9-98" name="__codelineno-9-98" href="#__codelineno-9-98"></a>                <span class="n">ChatMessage</span><span class="p">(</span>
<a id="__codelineno-9-99" name="__codelineno-9-99" href="#__codelineno-9-99"></a>                    <span class="n">role</span><span class="o">=</span><span class="s2">&quot;system&quot;</span><span class="p">,</span>
<a id="__codelineno-9-100" name="__codelineno-9-100" href="#__codelineno-9-100"></a>                    <span class="n">content</span><span class="o">=</span><span class="s2">&quot;You are a helpful assistant that can summarize audio transcripts.&quot;</span><span class="p">,</span>
<a id="__codelineno-9-101" name="__codelineno-9-101" href="#__codelineno-9-101"></a>                <span class="p">),</span>
<a id="__codelineno-9-102" name="__codelineno-9-102" href="#__codelineno-9-102"></a>                <span class="n">ChatMessage</span><span class="p">(</span>
<a id="__codelineno-9-103" name="__codelineno-9-103" href="#__codelineno-9-103"></a>                    <span class="n">role</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
<a id="__codelineno-9-104" name="__codelineno-9-104" href="#__codelineno-9-104"></a>                    <span class="n">content</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Summarize the following video transcript into a list of bullet points: </span><span class="si">{</span><span class="n">transcription_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-9-105" name="__codelineno-9-105" href="#__codelineno-9-105"></a>                <span class="p">),</span>
<a id="__codelineno-9-106" name="__codelineno-9-106" href="#__codelineno-9-106"></a>            <span class="p">]</span>
<a id="__codelineno-9-107" name="__codelineno-9-107" href="#__codelineno-9-107"></a>        <span class="p">)</span>
<a id="__codelineno-9-108" name="__codelineno-9-108" href="#__codelineno-9-108"></a>        <span class="n">summary_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm_handle</span><span class="o">.</span><span class="n">chat</span><span class="p">(</span><span class="n">dialog</span><span class="o">=</span><span class="n">dialog</span><span class="p">)</span>
<a id="__codelineno-9-109" name="__codelineno-9-109" href="#__codelineno-9-109"></a>        <span class="n">summary_message</span><span class="p">:</span> <span class="n">ChatMessage</span> <span class="o">=</span> <span class="n">summary_response</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span>
<a id="__codelineno-9-110" name="__codelineno-9-110" href="#__codelineno-9-110"></a>        <span class="n">summary</span> <span class="o">=</span> <span class="n">summary_message</span><span class="o">.</span><span class="n">content</span>
<a id="__codelineno-9-111" name="__codelineno-9-111" href="#__codelineno-9-111"></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="p">}</span>
<a id="__codelineno-9-112" name="__codelineno-9-112" href="#__codelineno-9-112"></a>
<a id="__codelineno-9-113" name="__codelineno-9-113" href="#__codelineno-9-113"></a><span class="n">endpoints</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-9-114" name="__codelineno-9-114" href="#__codelineno-9-114"></a>    <span class="p">{</span>
<a id="__codelineno-9-115" name="__codelineno-9-115" href="#__codelineno-9-115"></a>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;transcribe_video&quot;</span><span class="p">,</span>
<a id="__codelineno-9-116" name="__codelineno-9-116" href="#__codelineno-9-116"></a>        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/video/transcribe&quot;</span><span class="p">,</span>
<a id="__codelineno-9-117" name="__codelineno-9-117" href="#__codelineno-9-117"></a>        <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="s2">&quot;Transcribe a video&quot;</span><span class="p">,</span>
<a id="__codelineno-9-118" name="__codelineno-9-118" href="#__codelineno-9-118"></a>        <span class="s2">&quot;endpoint_cls&quot;</span><span class="p">:</span> <span class="n">TranscribeVideoEndpoint</span><span class="p">,</span>
<a id="__codelineno-9-119" name="__codelineno-9-119" href="#__codelineno-9-119"></a>    <span class="p">},</span>
<a id="__codelineno-9-120" name="__codelineno-9-120" href="#__codelineno-9-120"></a>    <span class="p">{</span>
<a id="__codelineno-9-121" name="__codelineno-9-121" href="#__codelineno-9-121"></a>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;summarize_video&quot;</span><span class="p">,</span>
<a id="__codelineno-9-122" name="__codelineno-9-122" href="#__codelineno-9-122"></a>        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/video/summarize&quot;</span><span class="p">,</span>
<a id="__codelineno-9-123" name="__codelineno-9-123" href="#__codelineno-9-123"></a>        <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="s2">&quot;Summarize a video&quot;</span><span class="p">,</span>
<a id="__codelineno-9-124" name="__codelineno-9-124" href="#__codelineno-9-124"></a>        <span class="s2">&quot;endpoint_cls&quot;</span><span class="p">:</span> <span class="n">SummarizeVideoEndpoint</span><span class="p">,</span>
<a id="__codelineno-9-125" name="__codelineno-9-125" href="#__codelineno-9-125"></a>    <span class="p">},</span>
<a id="__codelineno-9-126" name="__codelineno-9-126" href="#__codelineno-9-126"></a><span class="p">]</span>
<a id="__codelineno-9-127" name="__codelineno-9-127" href="#__codelineno-9-127"></a>
<a id="__codelineno-9-128" name="__codelineno-9-128" href="#__codelineno-9-128"></a><span class="n">aana_app</span> <span class="o">=</span> <span class="n">AanaSDK</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;summarize_video_app&quot;</span><span class="p">)</span>
<a id="__codelineno-9-129" name="__codelineno-9-129" href="#__codelineno-9-129"></a>
<a id="__codelineno-9-130" name="__codelineno-9-130" href="#__codelineno-9-130"></a><span class="k">for</span> <span class="n">deployment</span> <span class="ow">in</span> <span class="n">deployments</span><span class="p">:</span>
<a id="__codelineno-9-131" name="__codelineno-9-131" href="#__codelineno-9-131"></a>    <span class="n">aana_app</span><span class="o">.</span><span class="n">register_deployment</span><span class="p">(</span><span class="o">**</span><span class="n">deployment</span><span class="p">)</span>
<a id="__codelineno-9-132" name="__codelineno-9-132" href="#__codelineno-9-132"></a>
<a id="__codelineno-9-133" name="__codelineno-9-133" href="#__codelineno-9-133"></a><span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="n">endpoints</span><span class="p">:</span>
<a id="__codelineno-9-134" name="__codelineno-9-134" href="#__codelineno-9-134"></a>    <span class="n">aana_app</span><span class="o">.</span><span class="n">register_endpoint</span><span class="p">(</span><span class="o">**</span><span class="n">endpoint</span><span class="p">)</span>
<a id="__codelineno-9-135" name="__codelineno-9-135" href="#__codelineno-9-135"></a>
<a id="__codelineno-9-136" name="__codelineno-9-136" href="#__codelineno-9-136"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-9-137" name="__codelineno-9-137" href="#__codelineno-9-137"></a>    <span class="n">aana_app</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>  <span class="c1"># Connects to the Ray cluster or starts a new one.</span>
<a id="__codelineno-9-138" name="__codelineno-9-138" href="#__codelineno-9-138"></a>    <span class="n">aana_app</span><span class="o">.</span><span class="n">migrate</span><span class="p">()</span>  <span class="c1"># Runs the migrations to create the database tables.</span>
<a id="__codelineno-9-139" name="__codelineno-9-139" href="#__codelineno-9-139"></a>    <span class="n">aana_app</span><span class="o">.</span><span class="n">deploy</span><span class="p">()</span>  <span class="c1"># Deploys the application.</span>
</code></pre></div>
<p>Now you can run the application as described in the previous section and send a request to summarize the video transcript.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://127.0.0.1:8000/video/summarize<span class="w"> </span>-Fbody<span class="o">=</span><span class="s1">&#39;{&quot;video&quot;:{&quot;url&quot;:&quot;https://www.youtube.com/watch?v=VhJFyyukAzA&quot;}}&#39;</span>
</code></pre></div>
<p>We will get a response with the summary key containing the bullet points on how to make perfect scrambled eggs.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="mi">-</span><span class="w"> </span><span class="err">Never</span><span class="w"> </span><span class="err">seaso</span><span class="kc">n</span><span class="w"> </span><span class="err">eggs</span><span class="w"> </span><span class="err">be</span><span class="kc">f</span><span class="err">ore</span><span class="w"> </span><span class="err">cooki</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="err">preve</span><span class="kc">nt</span><span class="w"> </span><span class="kc">t</span><span class="err">hem</span><span class="w"> </span><span class="kc">fr</span><span class="err">om</span><span class="w"> </span><span class="kc">turn</span><span class="err">i</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="err">gray</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">wa</span><span class="kc">ter</span><span class="err">y</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="mi">-</span><span class="w"> </span><span class="err">Fill</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">pa</span><span class="kc">n</span><span class="w"> </span><span class="mi">3</span><span class="err">/</span><span class="mi">4</span><span class="w"> </span><span class="kc">full</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">clea</span><span class="kc">n</span><span class="w"> </span><span class="err">i</span><span class="kc">t</span><span class="w"> </span><span class="err">as</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">go</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="err">e</span><span class="kc">nsure</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">clea</span><span class="kc">n</span><span class="w"> </span><span class="err">cooki</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="err">sur</span><span class="kc">fa</span><span class="err">ce</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="mi">-</span><span class="w"> </span><span class="err">Do</span><span class="w"> </span><span class="kc">n</span><span class="err">o</span><span class="kc">t</span><span class="w"> </span><span class="err">whisk</span><span class="w"> </span><span class="err">eggs</span><span class="w"> </span><span class="err">be</span><span class="kc">f</span><span class="err">ore</span><span class="w"> </span><span class="err">cooki</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="err">avoid</span><span class="w"> </span><span class="err">over</span><span class="mi">-</span><span class="err">mixi</span><span class="kc">n</span><span class="err">g</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="mi">-</span><span class="w"> </span><span class="err">Cook</span><span class="w"> </span><span class="err">eggs</span><span class="w"> </span><span class="err">o</span><span class="kc">ff</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">hea</span><span class="kc">t</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">co</span><span class="kc">nt</span><span class="err">i</span><span class="kc">nue</span><span class="w"> </span><span class="err">s</span><span class="kc">t</span><span class="err">irri</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="err">co</span><span class="kc">ntr</span><span class="err">ol</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">cooki</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="err">process</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="mi">-</span><span class="w"> </span><span class="err">Use</span><span class="w"> </span><span class="err">bu</span><span class="kc">tter</span><span class="w"> </span><span class="kc">f</span><span class="err">or</span><span class="w"> </span><span class="kc">fla</span><span class="err">vor</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="err">crea</span><span class="kc">te</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="kc">n</span><span class="err">o</span><span class="kc">n</span><span class="mi">-</span><span class="err">s</span><span class="kc">t</span><span class="err">ick</span><span class="w"> </span><span class="err">sur</span><span class="kc">fa</span><span class="err">ce</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="mi">-</span><span class="w"> </span><span class="err">S</span><span class="kc">t</span><span class="err">op</span><span class="w"> </span><span class="err">cooki</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="err">eggs</span><span class="w"> </span><span class="err">as</span><span class="w"> </span><span class="err">soo</span><span class="kc">n</span><span class="w"> </span><span class="err">as</span><span class="w"> </span><span class="kc">t</span><span class="err">hey</span><span class="w"> </span><span class="err">reach</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">desired</span><span class="w"> </span><span class="err">level</span><span class="w"> </span><span class="err">o</span><span class="kc">f</span><span class="w"> </span><span class="err">do</span><span class="kc">neness</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="err">preve</span><span class="kc">nt</span><span class="w"> </span><span class="err">rubbery</span><span class="w"> </span><span class="kc">te</span><span class="err">x</span><span class="kc">ture</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="mi">-</span><span class="w"> </span><span class="err">Add</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="kc">teas</span><span class="err">poo</span><span class="kc">n</span><span class="w"> </span><span class="err">o</span><span class="kc">f</span><span class="w"> </span><span class="err">sour</span><span class="w"> </span><span class="err">cream</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">creme</span><span class="w"> </span><span class="kc">fra</span><span class="err">iche</span><span class="w"> </span><span class="kc">f</span><span class="err">or</span><span class="w"> </span><span class="err">ex</span><span class="kc">tra</span><span class="w"> </span><span class="err">creami</span><span class="kc">ness</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="mi">-</span><span class="w"> </span><span class="err">Seaso</span><span class="kc">n</span><span class="w"> </span><span class="err">wi</span><span class="kc">t</span><span class="err">h</span><span class="w"> </span><span class="err">sal</span><span class="kc">t</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">pepper</span><span class="w"> </span><span class="err">a</span><span class="kc">t</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">e</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="kc">f</span><span class="err">or</span><span class="w"> </span><span class="kc">taste</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="mi">-</span><span class="w"> </span><span class="err">S</span><span class="kc">t</span><span class="err">ir</span><span class="w"> </span><span class="err">co</span><span class="kc">nt</span><span class="err">i</span><span class="kc">nu</span><span class="err">ously</span><span class="w"> </span><span class="kc">f</span><span class="err">or</span><span class="w"> </span><span class="kc">fluff</span><span class="err">y</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">ligh</span><span class="kc">t</span><span class="w"> </span><span class="err">scrambled</span><span class="w"> </span><span class="err">eggs</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="mi">-</span><span class="w"> </span><span class="err">Avoid</span><span class="w"> </span><span class="err">seaso</span><span class="kc">n</span><span class="err">i</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">whiski</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="err">eggs</span><span class="w"> </span><span class="err">be</span><span class="kc">f</span><span class="err">ore</span><span class="w"> </span><span class="err">cooki</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="kc">f</span><span class="err">or</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">bes</span><span class="kc">t</span><span class="w"> </span><span class="err">resul</span><span class="kc">ts</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="mi">-</span><span class="w"> </span><span class="err">Clea</span><span class="kc">n</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">pa</span><span class="kc">n</span><span class="w"> </span><span class="kc">t</span><span class="err">hroughou</span><span class="kc">t</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">cooki</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="err">process</span><span class="w"> </span><span class="kc">f</span><span class="err">or</span><span class="w"> </span><span class="err">op</span><span class="kc">t</span><span class="err">imal</span><span class="w"> </span><span class="err">resul</span><span class="kc">ts</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="mi">-</span><span class="w"> </span><span class="err">Use</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="kc">n</span><span class="err">o</span><span class="kc">n</span><span class="mi">-</span><span class="err">s</span><span class="kc">t</span><span class="err">ick</span><span class="w"> </span><span class="err">pa</span><span class="kc">n</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">spa</span><span class="kc">tula</span><span class="w"> </span><span class="kc">f</span><span class="err">or</span><span class="w"> </span><span class="err">easy</span><span class="w"> </span><span class="err">cooki</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">s</span><span class="kc">t</span><span class="err">irri</span><span class="kc">n</span><span class="err">g</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="mi">-</span><span class="w"> </span><span class="err">Cook</span><span class="w"> </span><span class="err">eggs</span><span class="w"> </span><span class="err">o</span><span class="kc">ff</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">hea</span><span class="kc">t</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">co</span><span class="kc">nt</span><span class="err">i</span><span class="kc">nue</span><span class="w"> </span><span class="err">s</span><span class="kc">t</span><span class="err">irri</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="err">mai</span><span class="kc">nta</span><span class="err">i</span><span class="kc">n</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">desired</span><span class="w"> </span><span class="kc">te</span><span class="err">x</span><span class="kc">ture</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="mi">-</span><span class="w"> </span><span class="err">Add</span><span class="w"> </span><span class="err">sour</span><span class="w"> </span><span class="err">cream</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">creme</span><span class="w"> </span><span class="kc">fra</span><span class="err">iche</span><span class="w"> </span><span class="kc">f</span><span class="err">or</span><span class="w"> </span><span class="err">added</span><span class="w"> </span><span class="err">creami</span><span class="kc">ness</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="kc">fla</span><span class="err">vor</span>
</code></pre></div>
<h2 id="streaming-llm-output">Streaming LLM Output<a class="headerlink" href="#streaming-llm-output" title="Permanent link">&para;</a></h2>
<p>In the example above, we used the <code>chat</code> method to interact with the LLM model. The <code>chat</code> method returns a single response message once the model has finished processing the input. However, in some cases, you may want to stream the output from the LLM model as it is being generated.</p>
<p>Our LLM deployments support streaming output using the <code>chat_stream</code> method. It's implemented as an asynchronous generator that yields text as it is generated by the model. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">async</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">llm_handle</span><span class="o">.</span><span class="n">chat_stream</span><span class="p">(</span><span class="n">dialog</span><span class="o">=</span><span class="n">dialog</span><span class="p">):</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</code></pre></div>
<p>Now we can modify the <code>SummarizeVideoEndpoint</code> to stream the output from the LLM model. For demonstration purposes, we will create a new endpoint <code>SummarizeVideoStreamEndpoint</code> that is a streaming version of the <code>SummarizeVideoEndpoint</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">SummarizeVideoStreamEndpointOutput</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Summarize video endpoint output.&quot;&quot;&quot;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    <span class="n">text</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;The text chunk.&quot;</span><span class="p">)]</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">SummarizeVideoStreamEndpoint</span><span class="p">(</span><span class="n">Endpoint</span><span class="p">):</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Summarize video endpoint with streaming output.&quot;&quot;&quot;</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the endpoint.&quot;&quot;&quot;</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>        <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">asr_handle</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AanaDeploymentHandle</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;asr_deployment&quot;</span><span class="p">)</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">llm_handle</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AanaDeploymentHandle</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;llm_deployment&quot;</span><span class="p">)</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">video</span><span class="p">:</span> <span class="n">VideoInput</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n">SummarizeVideoStreamEndpointOutput</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Summarize video.&quot;&quot;&quot;</span>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>        <span class="n">video_obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_remote</span><span class="p">(</span><span class="n">download_video</span><span class="p">)(</span><span class="n">video_input</span><span class="o">=</span><span class="n">video</span><span class="p">)</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>        <span class="n">audio</span> <span class="o">=</span> <span class="n">extract_audio</span><span class="p">(</span><span class="n">video</span><span class="o">=</span><span class="n">video_obj</span><span class="p">)</span>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>        <span class="n">transcription</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">asr_handle</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span><span class="n">audio</span><span class="o">=</span><span class="n">audio</span><span class="p">)</span>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>        <span class="n">transcription_text</span> <span class="o">=</span> <span class="n">transcription</span><span class="p">[</span><span class="s2">&quot;transcription&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>        <span class="n">dialog</span> <span class="o">=</span> <span class="n">ChatDialog</span><span class="p">(</span>
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>            <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>                <span class="n">ChatMessage</span><span class="p">(</span>
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a>                    <span class="n">role</span><span class="o">=</span><span class="s2">&quot;system&quot;</span><span class="p">,</span>
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a>                    <span class="n">content</span><span class="o">=</span><span class="s2">&quot;You are a helpful assistant that can summarize audio transcripts.&quot;</span><span class="p">,</span>
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a>                <span class="p">),</span>
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a>                <span class="n">ChatMessage</span><span class="p">(</span>
<a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a>                    <span class="n">role</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
<a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>                    <span class="n">content</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Summarize the following video transcript into a list of bullet points: </span><span class="si">{</span><span class="n">transcription_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a>                <span class="p">),</span>
<a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a>            <span class="p">]</span>
<a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a>        <span class="p">)</span>
<a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a>        <span class="k">async</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm_handle</span><span class="o">.</span><span class="n">chat_stream</span><span class="p">(</span><span class="n">dialog</span><span class="o">=</span><span class="n">dialog</span><span class="p">):</span>
<a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a>            <span class="n">chunk_text</span> <span class="o">=</span> <span class="n">chunk</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
<a id="__codelineno-13-37" name="__codelineno-13-37" href="#__codelineno-13-37"></a>            <span class="k">yield</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">chunk_text</span><span class="p">}</span>
</code></pre></div>
<p>The difference between the non-streaming version and the streaming version:</p>
<ul>
<li><code>run</code> method is now an asynchronous generator that yields <code>SummarizeVideoEndpointOutput</code> objects: <code>AsyncGenerator[SummarizeVideoEndpointOutput, None]</code>. If you want endpoint to be able to stream output, you need to define the output type as an asynchronous generator to let the SDK know that the endpoint will be streaming output.</li>
<li>We use the <code>chat_stream</code> method to interact with the LLM model. The <code>chat_stream</code> method returns an asynchronous generator that yields text as it is generated by the model. We use <code>async for</code> to iterate over the generator and yield the text chunks as they are generated.</li>
<li>We use <code>yield</code> to yield the text chunks as they are generated by the LLM model instead of using <code>return</code> to return a single response.</li>
<li>The output dictionary now contains a single key <code>text</code> that contains the text chunk generated by the LLM model instead of a single key <code>summary</code>.</li>
</ul>
<p>That's it! Now you have a streaming version of the summarization endpoint and you can display the output as it is generated by the LLM model.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span><span class="o">,</span><span class="w"> </span><span class="nn">json</span><span class="p">;</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="p">[</span><span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">c</span><span class="p">)[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> 
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>    <span class="s1">&#39;http://127.0.0.1:8000/video/summarize_stream&#39;</span><span class="p">,</span> 
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>    <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;video&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://www.youtube.com/watch?v=VhJFyyukAzA&#39;</span><span class="p">}})},</span> 
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>    <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="s2">&quot;</span>
</code></pre></div>
<h2 id="app-template">App Template<a class="headerlink" href="#app-template" title="Permanent link">&para;</a></h2>
<p>The best way to start building a new application is to use <a href="https://github.com/mobiusml/aana_app_template">Aana App Template</a>. It is a GitHub template repository that you can use to create a new repository with the same directory structure and files as the template. It will help you get started with the Aana SDK and provide you with a basic structure for your application and its dependencies.</p>
<p>Let's create a new project using the Aana App Template:</p>
<h3 id="create-a-new-repository">Create a New Repository<a class="headerlink" href="#create-a-new-repository" title="Permanent link">&para;</a></h3>
<p>Go to the <a href="https://github.com/new?template_name=aana_app_template">Aana App Template</a>. Choose a name for your repository and fill in the other details. Click on the "Create repository" button. GitHub will create a new repository with the same directory structure and files as the template. There is a GitHub Actions workflow that will run after the repository is created to modify the project name to match the repository name. It is pretty fast but make sure it's finished before you proceed.</p>
<h3 id="clone-the-repository">Clone the Repository<a class="headerlink" href="#clone-the-repository" title="Permanent link">&para;</a></h3>
<p>Clone the repository to your local machine:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>git<span class="w"> </span>clone<span class="w"> </span>&lt;repository-url&gt;
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="nb">cd</span><span class="w"> </span>&lt;repository-name&gt;
</code></pre></div>
<h3 id="create-the-application">Create the Application<a class="headerlink" href="#create-the-application" title="Permanent link">&para;</a></h3>
<p>For our example project we need to adjust a few things.</p>
<h4 id="deployments_1">Deployments<a class="headerlink" href="#deployments_1" title="Permanent link">&para;</a></h4>
<p>Define the deployments in the <a href="https://github.com/mobiusml/aana_app_template/blob/main/aana_app_project/configs/deployments.py"><code>configs/deployments.py</code></a>. </p>
<p>For our summarization project it looks like this: </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">BitsAndBytesConfig</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.deployments.hf_text_generation_deployment</span><span class="w"> </span><span class="kn">import</span> <span class="n">HfTextGenerationConfig</span><span class="p">,</span> <span class="n">HfTextGenerationDeployment</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana.deployments.whisper_deployment</span><span class="w"> </span><span class="kn">import</span> <span class="n">WhisperComputeType</span><span class="p">,</span> <span class="n">WhisperConfig</span><span class="p">,</span> <span class="n">WhisperDeployment</span><span class="p">,</span> <span class="n">WhisperModelSize</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="n">asr_deployment</span> <span class="o">=</span> <span class="n">WhisperDeployment</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>    <span class="n">num_replicas</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>    <span class="n">ray_actor_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_gpus&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">},</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>    <span class="n">user_config</span><span class="o">=</span><span class="n">WhisperConfig</span><span class="p">(</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>        <span class="n">model_size</span><span class="o">=</span><span class="n">WhisperModelSize</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>        <span class="n">compute_type</span><span class="o">=</span><span class="n">WhisperComputeType</span><span class="o">.</span><span class="n">FLOAT16</span><span class="p">,</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>    <span class="p">)</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">),</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="p">)</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="n">llm_deployment</span> <span class="o">=</span> <span class="n">HfTextGenerationDeployment</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>    <span class="n">num_replicas</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>    <span class="n">ray_actor_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_gpus&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">},</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>    <span class="n">user_config</span><span class="o">=</span><span class="n">HfTextGenerationConfig</span><span class="p">(</span>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>        <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;microsoft/Phi-3-mini-4k-instruct&quot;</span><span class="p">,</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>        <span class="n">model_kwargs</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>            <span class="s2">&quot;trust_remote_code&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>            <span class="s2">&quot;quantization_config&quot;</span><span class="p">:</span> <span class="n">BitsAndBytesConfig</span><span class="p">(</span>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a>                <span class="n">load_in_8bit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">load_in_4bit</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a>            <span class="p">),</span>
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a>        <span class="p">},</span>
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a>    <span class="p">)</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">),</span>
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a><span class="p">)</span>
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a>
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a>
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a><span class="n">deployments</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a>    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;asr_deployment&quot;</span><span class="p">,</span> <span class="s2">&quot;instance&quot;</span><span class="p">:</span> <span class="n">asr_deployment</span><span class="p">},</span>
<a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a>    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;llm_deployment&quot;</span><span class="p">,</span> <span class="s2">&quot;instance&quot;</span><span class="p">:</span> <span class="n">llm_deployment</span><span class="p">},</span>
<a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a><span class="p">]</span>
</code></pre></div>
<p>See <a href="https://github.com/mobiusml/aana_summarize_video/blob/main/aana_summarize_video/configs/deployments.py"><code>aana_summarize_video/configs/deployments.py</code></a>.</p>
<h4 id="endpoints_1">Endpoints<a class="headerlink" href="#endpoints_1" title="Permanent link">&para;</a></h4>
<p>The endpoints are defined in the <a href="https://github.com/mobiusml/aana_summarize_video/tree/main/aana_summarize_video/endpoints"><code>aana_summarize_video/endpoints</code></a> directory. It is a good practice to define each endpoint in a separate file. In our case, we will define 3 endpoints in 3 separate files: <code>transcribe_video.py</code>, <code>summarize_video.py</code>, and <code>summarize_video_stream.py</code>.</p>
<p>We also need to register the endpoints. The list of endpoints is defined in the <a href="https://github.com/mobiusml/aana_app_template/blob/main/aana_app_project/configs/endpoints.py"><code>configs/endpoints.py</code></a>.</p>
<p>For this project we need to register 3 endpoints:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana_summarize_video.endpoints.summarize_video</span><span class="w"> </span><span class="kn">import</span> <span class="n">SummarizeVideoEndpoint</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana_summarize_video.endpoints.summarize_video_stream</span><span class="w"> </span><span class="kn">import</span> <span class="n">SummarizeVideoStreamEndpoint</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aana_summarize_video.endpoints.transcribe_video</span><span class="w"> </span><span class="kn">import</span> <span class="n">TranscribeVideoEndpoint</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="n">endpoints</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>    <span class="p">{</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;transcribe_video&quot;</span><span class="p">,</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/video/transcribe&quot;</span><span class="p">,</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>        <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="s2">&quot;Transcribe a video&quot;</span><span class="p">,</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>        <span class="s2">&quot;endpoint_cls&quot;</span><span class="p">:</span> <span class="n">TranscribeVideoEndpoint</span><span class="p">,</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>    <span class="p">},</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>    <span class="p">{</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;summarize_video&quot;</span><span class="p">,</span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/video/summarize&quot;</span><span class="p">,</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>        <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="s2">&quot;Summarize a video&quot;</span><span class="p">,</span>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>        <span class="s2">&quot;endpoint_cls&quot;</span><span class="p">:</span> <span class="n">SummarizeVideoEndpoint</span><span class="p">,</span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>    <span class="p">},</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>    <span class="p">{</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;summarize_video_stream&quot;</span><span class="p">,</span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/video/summarize_stream&quot;</span><span class="p">,</span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a>        <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="s2">&quot;Summarize a video with streaming output&quot;</span><span class="p">,</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>        <span class="s2">&quot;endpoint_cls&quot;</span><span class="p">:</span> <span class="n">SummarizeVideoStreamEndpoint</span><span class="p">,</span>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a>    <span class="p">},</span>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="p">]</span>
</code></pre></div>
<p>See <a href="https://github.com/mobiusml/aana_summarize_video/blob/main/aana_summarize_video/configs/endpoints.py"><code>aana_summarize_video/configs/endpoints.py</code></a>.</p>
<h3 id="run-the-application">Run the Application<a class="headerlink" href="#run-the-application" title="Permanent link">&para;</a></h3>
<p>Now you can run the application:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>aana<span class="w"> </span>deploy<span class="w"> </span>aana_summarize_video.app:aana_app
</code></pre></div>
<p>Or if you want to be on the safe side, you can run the application with <code>poetry run</code> and CUDA_VISIBLE_DEVICES set to the GPU index you want to use:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>poetry<span class="w"> </span>run<span class="w"> </span>aana<span class="w"> </span>deploy<span class="w"> </span>aana_summarize_video.app:aana_app
</code></pre></div>
<p>Once the application is running, you can send a request to transcribe and summarize a video as described in the previous sections.</p>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>In this tutorial, we have walked you through the process of creating a new project with Aana SDK. We have reviewed the video transcription application and extended it to include the LLM model for summarization and a new endpoint. We have also demonstrated how to stream the output from the LLM model. You can use this tutorial as a reference to build your own applications with Aana SDK. </p>
<p>The full code for the application is available in the <a href="https://github.com/mobiusml/aana_sdk/tree/main/aana/projects/summarize_transcript">projects</a> directory.</p>







  
  




  



                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/mobiusml/aana_sdk" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://x.com/Mobius_Labs" target="_blank" rel="noopener" title="x.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.indexes", "navigation.path", "toc.follow", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy", "content.tooltips"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  </body>
</html>